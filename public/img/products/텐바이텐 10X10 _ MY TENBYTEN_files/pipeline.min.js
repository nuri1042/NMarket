"use strict";var _createClass=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var pp_instance=void 0,DataGen=function(){function e(){if(_classCallCheck(this,e),pp_instance)return pp_instance;this.KINESIS="BIS-ACTIVITY-STREAM",this.BASE_URL="https://gqb7it2caj.execute-api.ap-northeast-2.amazonaws.com/prod/streams/",this.API_KEY="7wqxMesqxVa88OpaZEoFb91l1TWwa2ZJ6b5WjOWg",this.W_TARGET_MAP={main:{identifier:"",path:["/","/index.asp"],key:"main"},search:{identifier:"rect",path:["/search/search_result.asp"],key:"search"},category:{identifier:"disp",path:["/shopping/category_list.asp","/shopping/category_main.asp"],key:"category"},event:{identifier:"eventid",path:["/event/eventmain.asp"],key:"event"},brand:{identifier:"",path:["/street/","/street/index.asp"],key:"brand"},brandview:{identifier:"makerid",path:["/street/street_brand_sub06.asp"],key:"brandview"},itemview:{identifier:"itemid",path:["/shopping/category_prd.asp"],key:"itemview"},deal:{identifier:"itemid",path:["/deal/deal.asp"],key:"deal"},new:{identifier:"",path:["/shoppingtoday/shoppingchance_newitem.asp"],key:"new"},best:{identifier:"",path:["/award/awardlist.asp"],key:"best"},sale:{identifier:"",path:["/shoppingtoday/shoppingchance_saleitem.asp"],key:"sale"},clearance:{identifier:"",path:["/clearancesale/","/clearancesale/index.asp"],key:"clearance"},basket:{identifier:"",path:["/inipay/shoppingbag.asp"],key:"basket"},wish:{identifier:"",path:["/my10x10/mywishlist.asp"],key:"wish"},ds:{identifier:"",path:["/diarystory2020/","/diarystory2020/index.asp"],key:"ds"}},this.A_TARGET_MAP={main:{identifier:"",path:["/apps/appCom/wish/web2014/today/index.asp","/apps/appCom/wish/web2014/today/"],key:"main"},category:{identifier:"disp",path:["/apps/appCom/wish/web2014/category/category_main.asp"],key:"category"},event:{identifier:"eventid",path:["/apps/appCom/wish/web2014/event/eventmain.asp"],key:"event"},brand:{identifier:"",path:["/apps/appCom/wish/web2014/street/","/apps/appCom/wish/web2014/street/index.asp"],key:"brand"},itemview:{identifier:"itemid",path:["/apps/appCom/wish/web2014/category/category_itemPrd.asp"],key:"itemview"},deal:{identifier:"itemid",path:["/apps/appCom/wish/web2014/deal/deal.asp"],key:"deal"},dealview:{identifier:"itemid",path:["/apps/appCom/wish/web2014/deal/deal_view.asp"],key:"dealview"},gnbevent:{identifier:"eventid",path:["/apps/appcom/wish/web2014/event/gnbeventmain.asp"],key:"gnbevent"},new:{identifier:"",path:["/apps/appcom/wish/web2014/newitem/newitem.asp"],key:"new"},best:{identifier:"",path:["/apps/appcom/wish/web2014/award/awarditem.asp"],key:"best"},sale:{identifier:"",path:["/apps/appcom/wish/web2014/sale/saleitem.asp"],key:"sale"},clearance:{identifier:"",path:["/apps/appcom/wish/web2014/clearancesale/","/apps/appcom/wish/web2014/clearancesale/index.asp"],key:"clearance"},basket:{identifier:"",path:["/apps/appCom/wish/web2014/inipay/ShoppingBag.asp"],key:"basket"},wish:{identifier:"",path:["/apps/appCom/wish/web2014/my10x10/mywish/mywish.asp"],key:"wish"},ds:{identifier:"",path:["/apps/appCom/wish/web2014/diarystory2020/","/apps/appCom/wish/web2014/diarystory2020/index.asp"],key:"ds"}},this.M_TARGET_MAP={main:{identifier:"",path:["/","/index.asp"],key:"main"},search:{identifier:"rect",path:["/search/search_item.asp"],key:"search"},category:{identifier:"disp",path:["/category/category_list.asp","/category/category_main.asp"],key:"category"},event:{identifier:"eventid",path:["/event/eventmain.asp"],key:"event"},gnbevent:{identifier:"eventid",path:["/subgnb/gnbeventmain.asp"],key:"gnbevent"},brand:{identifier:"",path:["/street/","/street/index.asp"],key:"brand"},brandview:{identifier:"makerid",path:["/street/street_brand.asp"],key:"brandview"},itemview:{identifier:"itemid",path:["/category/category_itemPrd.asp"],key:"itemview"},deal:{identifier:"itemid",path:["/deal/deal.asp"],key:"deal"},dealview:{identifier:"itemid",path:["/deal/deal_view.asp"],key:"dealview"},new:{identifier:"",path:["/shoppingtoday/shoppingchance_newitem.asp"],key:"new"},best:{identifier:"",path:["/award/awarditem.asp"],key:"best"},sale:{identifier:"",path:["/shoppingtoday/shoppingchance_saleitem.asp"],key:"sale"},clearance:{identifier:"",path:["/clearancesale/","/clearancesale/index.asp"],key:"clearance"},basket:{identifier:"",path:["/inipay/ShoppingBag.asp"],key:"basket"},wish:{identifier:"",path:["/my10x10/mywish/mywish.asp"],key:"wish"},ds:{identifier:"",path:["/diarystory2020/","/diarystory2020/index.asp"],key:"ds"}},this.itemId=null,this.fixeddate=this.getCurrentDate(),this.lgseq=null,this.ip=null,this.siseq=null,this.ua=null,this.pg=null,this.tg=null,this.tp=null,this.cpg=null,this.chn=this.getChannel(),this.inflow1=null,this.inflow2=null,this.inflow3=null,this.inflow4=null,this.referer=null,this.rdsite=null,this.source=null,this.medium=null,this.campaign=null,this.qs=decodeURIComponent(window.location.search.replace(/\+/g," "))||null,this.allCookies=Cookies.get(),this.qsObj=this.getQueryObject(),this.currentTarget=null,this.gaParam=this.qsObj.gaparam,this.payload={},this.currentTargetMap=null,this.init(),pp_instance=this}return _createClass(e,[{key:"setTargetMap",value:function(){switch(this.chn){case"w":this.currentTargetMap=this.W_TARGET_MAP;break;case"a":this.currentTargetMap=this.A_TARGET_MAP;break;case"m":this.currentTargetMap=this.M_TARGET_MAP;break;default:this.currentTargetMap=null}}},{key:"getQueryObject",value:function(e){var t=(e=null==e?window.location.href.toLowerCase():e.toLowerCase()).substring(e.lastIndexOf("?")+1),n={};return t.replace(/([^?&=]+)=([^?&=]*)/g,function(e,t,i){var a=decodeURIComponent(t),s=decodeURIComponent(i);return s=String(s),n[a]=s,e}),n}},{key:"getCookiesWithRE",value:function(t){var i=this,a=void 0;return Object.keys(this.allCookies).forEach(function(e){t.test(e)&&(a=i.allCookies[e])}),a}},{key:"getCurrentDate",value:function(){var e=new Date;return e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)}},{key:"getParameterByName",value:function(e,t){t=t||window.location.href,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}},{key:"getClientIPAddress",value:function(){return $.getJSON("https://api.ipify.org?format=json")}},{key:"getChannel",value:function(){var e=void 0;return-1<navigator.userAgent.indexOf("tenapp")?e="a":-1<window.location.href.indexOf("m.10x10")?e="m":-1<window.location.href.indexOf("www.10x10")&&(e="w"),e}},{key:"setData",value:function(){var i=this;try{return(this.setTargetMap(),Object.keys(this.currentTargetMap).forEach(function(t){i.currentTargetMap[t].path.forEach(function(e){e.toLowerCase()===window.location.pathname.toLowerCase()&&(i.currentTarget=i.currentTargetMap[t])})}),this.currentTarget)?(this.itemId=this.qsObj.itemid,this.lgseq=this.allCookies.ggsn,this.siseq=this.getCookiesWithRE(/^ASPSESSIONID[A-Z]+/),this.ua=navigator.userAgent,this.pg=this.currentTarget?this.currentTarget.key:null,this.tg=this.getTG(),this.tp=this.getTP(),this.cpg=this.getCurrentPage(),this.setInflowData(),this.referer=decodeURIComponent(document.referrer.replace(/\+/g," ")),this.rdsite=this.allCookies.rdsite?decodeURIComponent(this.allCookies.rdsite):null,this.source=this.qsObj.utm_source||null,this.medium=this.qsObj.utm_medium||null,this.campaign=this.qsObj.utm_campaign||null,!0):!1}catch(e){return console.error(e),!1}}},{key:"getTG",value:function(){return this.currentTarget&&this.filterIdf(this.qsObj[this.currentTarget.identifier])||null}},{key:"filterIdf",value:function(e){if(!e)return null;return e.substr(0,-1!=e.indexOf("#")?e.indexOf("#"):e.length)}},{key:"getTP",value:function(){var e=null;return"dealview"===this.currentTarget.key&&(e=this.qsObj.dealitemid),this.filterIdf(e)}},{key:"getCurrentPage",value:function(){var t=this,i=null;try{this.currentTarget&&(["category","search","new","sale","clearance","brandview"].forEach(function(e){t.currentTarget.key===e&&(i=t.qsObj.cpg||1)}),"dealview"===this.currentTarget.key&&(i=this.qsObj.viewnum))}catch(e){console.error(e)}return i||null}},{key:"setInflowData",value:function(){function e(e,t,i,a){s.inflow1=e||null,s.inflow2=t||null,s.inflow3=i||null,s.inflow4=a||null}var s=this,t=null,i=null;this.qsObj.rc&&(t=this.qsObj.rc.split("_")[1],i=this.qsObj.rc.split("_")[2]),this.qsObj.prtr?e("prtr",this.qsObj.prtr,t,i):this.qsObj.petr?e("petr",this.qsObj.petr):this.qsObj.pctr?e("pctr",this.qsObj.pctr,t,i):this.qsObj.pbtr?e("pbtr",this.qsObj.pbtr,t,i):this.qsObj.rc?e("rc",t,i):this.qsObj.gaparam&&e(this.gaParam.split("_")[0],this.gaParam.split("_")[1],this.gaParam.split("_")[2])}},{key:"makePayload",value:function(){var e={StreamName:this.KINESIS,Data:{fixeddate:this.fixeddate,lgseq:this.lgseq,siseq:this.siseq,ua:this.ua,pg:this.pg,tg:this.tg,tp:this.tp,cpg:this.cpg,chn:this.chn,inflow1:this.inflow1,inflow2:this.inflow2,inflow3:this.inflow3,inflow4:this.inflow4,referer:this.referer,rdsite:this.rdsite,source:this.source,medium:this.medium,campaign:this.campaign,qs:this.qs},PartitionKey:this.lgseq};this.payload=e}},{key:"sendUserActivity",value:function(){var t=this;$.ajax({type:"POST",url:""+this.BASE_URL+this.KINESIS+"/",data:JSON.stringify(this.payload),beforeSend:function(e){e.setRequestHeader("X-API-Key",t.API_KEY),e.setRequestHeader("Content-type","application/json")},error:function(){console.error("sending data failed from front pipeline")},success:function(){}})}},{key:"handleEvt",value:function(){}},{key:"setAjaxInterceptor",value:function(a){var s;console.log("interceptor set"),XMLHttpRequest.prototype.open=(s=XMLHttpRequest.prototype.open,function(e,t,i){null!=a&&a instanceof Function&&a(e,t),s.apply(this,arguments)})}},{key:"setInterceptorOnPage",value:function(){var a=this;"w"==this.chn&&"deal"==this.currentTarget.key&&this.setAjaxInterceptor(function(e,t){if(-1<t.toLowerCase().indexOf("act_itemprd_pop.asp"))try{var i=a.getQueryObject(t);a.payload.Data.pg="dealview",a.payload.Data.qs=decodeURIComponent(t.substring(t.lastIndexOf("?")+1).replace(/\+/g," "))||null,a.payload.Data.tg=a.filterIdf(i.itemid),a.payload.Data.tp=a.filterIdf(i.dealitemid),a.sendUserActivity()}catch(e){console.error(e)}})}},{key:"init",value:function(){var e=this;window.setTimeout(function(){if(!e.setData())return!1;e.setInterceptorOnPage(),e.makePayload(),e.sendUserActivity()},0)}}]),e}(),dg1=new DataGen;